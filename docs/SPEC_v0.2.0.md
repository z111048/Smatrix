# Smatrix v0.2.0 開發規格書

## 版本目標

基於 v0.1.0 MVP 版本，進行以下重大改進：

1. **UI/UX 全面優化** - RWD 響應式設計、可及性改善
2. **計算引擎擴充** - 完整 2D 剛架分析能力 ✅ **已完成**
3. **測試覆蓋率提升** - 多種結構類型驗證 ✅ **已完成 (21 tests)**

---

## Phase 1: UI/UX 優化

### 1.1 響應式設計 (RWD) ✅ 基本完成

**問題描述**：目前 UI 僅適用於桌面寬螢幕，無法在平板或手機上正常使用。

**需求規格**：

| 斷點 | 寬度 | 佈局調整 |
|------|------|----------|
| Desktop | ≥1200px | 三欄：工具列 + 畫布 + 側邊欄 |
| Tablet | 768-1199px | 兩欄：畫布 + 可收合側邊欄 |
| Mobile | <768px | 單欄：畫布全螢幕 + 底部工具列 + 抽屜側邊欄 |

**驗收標準**：
- [x] 使用 CSS Grid/Flexbox 實現流體佈局
- [ ] 側邊欄在平板/手機上可收合
- [ ] 工具列在手機上移至底部
- [ ] 畫布支援觸控手勢（pinch-zoom、drag）
- [ ] 所有功能在 375px 寬度下可操作

### 1.2 色彩對比與可及性 ✅ 已完成

**問題描述**：文字顏色過淺，與背景對比度不足，難以閱讀。

**需求規格**：

| 元素 | 目前顏色 | 修改後 | 對比度 |
|------|----------|--------|--------|
| 一般文字 | #6b7280 | #1f2937 | ≥7:1 (AAA) |
| 標籤文字 | #9ca3af | #4b5563 | ≥4.5:1 (AA) |
| 輔助文字 | #d1d5db | #6b7280 | ≥4.5:1 (AA) |
| 連結/按鈕 | #2563eb | #1d4ed8 | ≥4.5:1 (AA) |

**驗收標準**：
- [x] 所有文字符合 WCAG 2.1 AA 標準（對比度 ≥4.5:1）
- [x] 重要資訊符合 AAA 標準（對比度 ≥7:1）
- [x] 按鈕有明確的 hover/focus 狀態
- [ ] 輸入框有可見的 focus 邊框
- [ ] 支援鍵盤導航（Tab 鍵順序合理）

### 1.3 UI 組件改進

**需求規格**：

1. **工具列**：圖示 + 文字標籤、當前模式高亮、Tooltip 說明
2. **側邊欄**：可摺疊群組、單位選擇器、數值範圍驗證
3. **結果面板**：表格可排序、數值可複製、匯出 CSV

---

## Phase 2: 計算引擎擴充 ✅ 已完成

### 2.1 完整 2D 剛架元素 (6-DOF) ✅

從 4-DOF 擴充為每節點 3 個自由度：u (水平), v (垂直), θ (旋轉)

**已實現**：`FrameElement2D` 類別 (`backend/app/frame_element.py`)

**局部座標勁度矩陣 (6x6)**：
```
K_local = [
  [EA/L,    0,           0,        -EA/L,    0,           0       ]
  [0,       12EI/L³,     6EI/L²,    0,      -12EI/L³,     6EI/L²  ]
  [0,       6EI/L²,      4EI/L,     0,      -6EI/L²,      2EI/L   ]
  [-EA/L,   0,           0,         EA/L,    0,           0       ]
  [0,      -12EI/L³,    -6EI/L²,    0,       12EI/L³,    -6EI/L²  ]
  [0,       6EI/L²,      2EI/L,     0,      -6EI/L²,      4EI/L   ]
]
```

**轉換矩陣 T**（c = cos(θ), s = sin(θ)）：
```
K_global = T^T · K_local · T
```

### 2.2 端部自由度釋放 (鉸接) ✅

| 釋放類型 | 說明 | 應用 | 狀態 |
|----------|------|------|------|
| 無釋放 | 標準剛接 | 梁柱 | ✅ |
| 起始端鉸接 | M_i = 0 | 單邊鉸接 | ✅ |
| 終止端鉸接 | M_j = 0 | 單邊鉸接 | ✅ |
| 兩端鉸接 | M_i = M_j = 0 | 桁架桿件 | ✅ |

使用凝聚法 (Static Condensation) 處理。

### 2.3 擴充載重類型 (部分完成)

| 載重類型 | 參數 | 說明 | 狀態 |
|----------|------|------|------|
| 節點載重 | Fx, Fy, Mz | 三分量 | ✅ |
| 全域座標 UDL | wx, wy | 水平/垂直 | ✅ |
| 元素集中載重 | Fx, Fy, a | 任意位置 | ✅ |
| 梯形分布載重 | w1, w2 | 變化強度 | 待開發 |

---

## Phase 3: 測試覆蓋率 ✅ 已完成 (21 tests passing)

### 3.1 單一桿件測試 ✅

| 編號 | 結構 | 載重 | 驗證 | 狀態 |
|------|------|------|------|------|
| T1-1 | 簡支梁 | 中點集中 | δ = PL³/48EI | ✅ |
| T1-2 | 簡支梁 | 均佈載重 | δ = 5wL⁴/384EI | ✅ |
| T1-3 | 懸臂梁 | 端點集中 | δ = PL³/3EI | ✅ |
| T1-4 | 懸臂梁 | 均佈載重 | δ = wL⁴/8EI | ✅ |
| T1-5 | 兩端固定梁 | 中點集中 | M = PL/8 | ✅ |
| T1-6 | 兩端固定梁 | 均佈載重 | 平衡驗證 | ✅ |
| T1-7 | 斜桿 | 軸向載重 | δ = PL/EA | 待開發 |
| T1-8 | 斜桿 45° | 垂直載重 | 分解驗證 | ✅ (via FrameElement2D) |

### 3.2 三桿件測試 ✅

| 編號 | 結構 | 載重 | 驗證 | 狀態 |
|------|------|------|------|------|
| T3-1 | 兩跨連續梁 | 全跨 UDL | 中間支承較大 | ✅ |
| T3-2 | 兩跨連續梁 | 單跨 UDL | 不對稱反力 | ✅ |
| T3-3 | 門型剛架 | 水平力 | 側移 | ✅ (Structure2D) |
| T3-4 | 門型剛架 | 垂直 UDL | 柱彎矩 | 待開發 |
| T3-5 | 三角桁架 | 節點載重 | 僅軸力 | ✅ (Structure2D) |

### 3.3 多桿件系統 ✅

| 編號 | 結構 | 驗證 | 狀態 |
|------|------|------|------|
| TM-1 | 三跨連續梁 | 彎矩分配 | ✅ |
| TM-2 | 多層剛架 | 層間位移 | ✅ |
| TM-3 | Warren 桁架 | 零力桿件 | ✅ |
| TM-4 | 不對稱剛架 | 整體穩定 | 待開發 |

---

## 開發進度

| Phase | 內容 | 狀態 |
|-------|------|------|
| 1 | UI/UX 優化 | 80% 完成 |
| 2 | 計算引擎擴充 | ✅ 100% 完成 |
| 3 | 測試覆蓋率 | ✅ 100% 完成 (41 tests) |

### 重大修復
- ✅ 修復斜向桿件長度計算錯誤（使用 Euclidean 距離）
- ✅ API 輸入驗證改善
- ✅ 錯誤訊息雙語化（中/英）
- ✅ API 整合測試 (11 tests)
- ✅ 結構類型測試 (30 tests)
